<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS - 晴空小筑</title><meta name=author content="pagezen">
<meta name=author-link content="http://clearsky.me/"><meta name=description content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta name=keywords content="SSL"><meta itemprop=name content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta itemprop=description content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta itemprop=datePublished content="2017-06-20T00:00:00+00:00"><meta itemprop=dateModified content="2023-05-02T19:18:14+08:00"><meta itemprop=wordCount content="2327"><meta itemprop=image content="https://clearsky.me/logo.png"><meta itemprop=keywords content="SSL,"><meta property="og:title" content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta property="og:description" content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta property="og:type" content="article"><meta property="og:url" content="https://clearsky.me/lets-encrypt/"><meta property="og:image" content="https://clearsky.me/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-06-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-02T19:18:14+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://clearsky.me/logo.png"><meta name=twitter:title content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta name=twitter:description content="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><meta name=application-name content="晴空小筑"><meta name=apple-mobile-web-app-title content="晴空小筑"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://clearsky.me/lets-encrypt/><link rel=prev href=https://clearsky.me/hexo-deploy-to-vps/><link rel=next href=https://clearsky.me/youtube-dl-ffmprg/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://unpkg.com/@fortawesome/fontawesome-free@6.4.2/css/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.4.2/css/all.min.css></noscript><link rel=preload href=https://unpkg.com/animate.css@4.1.1/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/clearsky.me\/lets-encrypt\/"},"genre":"posts","keywords":"SSL","wordcount":2327,"url":"https:\/\/clearsky.me\/lets-encrypt\/","datePublished":"2017-06-20T00:00:00+00:00","dateModified":"2023-05-02T19:18:14+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"pagezen"},"description":"申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><script>function randomPost(){fetch("/sitemap.xml").then(e=>e.text()).then(e=>(new window.DOMParser).parseFromString(e,"text/xml")).then(e=>{let s=e.querySelectorAll("url loc"),n,t;do n=s[Math.floor(Math.random()*s.length)].innerHTML,t=n.split("/")[3]||"";while(t==""||t=="tags"||t=="posts"||t=="categories"||t=="friends"||t=="toot"||t=="about")location.href=n})}function tofullScreen(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".ai-explanation-content").textContent;new TypeIt("#ai-explanation",{strings:e,speed:50,lifeLike:!0,waitUntilVisible:!0}).go()})</script><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class="header-title header__verification"><a href=/ title=晴空小筑><span class=header-title-pre><i class='fas fa-code'></i> </span><span class=header-title-text>晴空小筑</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/><i class='fas fa-home'></i> 首页</a></li><li class=menu-item><a class=menu-link href=/posts><i class='fas fa-clock'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/toot><i class='fa-brands fa-mastodon'></i> 嘟嘟</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fas fa-book'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags><i class='fas fa-tags'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about><i class='fas fa-user-tie'></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=在这里搜索一下... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class=menu-item><a class='fa-solid fa-expand' href=javascript:; onclick=tofullScreen() title=全屏阅读></a></li><li class=menu-item><a class='fa-regular fa-thumbs-up fa-bounce' href=javascript:; onclick=randomPost() title=随机访问一篇文章></a></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=晴空小筑><span class=header-title-pre><i class='fas fa-code'></i> </span><span class=header-title-text>晴空小筑</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=在这里搜索一下... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/><i class='fas fa-home'></i> 首页</a></li><li class=menu-item><a class=menu-link href=/posts><i class='fas fa-clock'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/toot><i class='fa-brands fa-mastodon'></i> 嘟嘟</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fas fa-book'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags><i class='fas fa-tags'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about><i class='fas fa-user-tie'></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel=stylesheet></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/ title=晴空小筑>主页</a></li><li class=breadcrumb-item><a href=/posts/ title=文章>文章</a></li><li class="breadcrumb-item active" aria-current=page>申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=http://clearsky.me/ title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src="https://gravatar.loli.net/avatar/e99a2f3e251df360c9ec3b2e50648c15?s=32&amp;d=mp" data-title=pagezen data-alt=pagezen class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;pagezen</a></span>
<span class=post-category>收录于 <a href=/categories/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 乱七八糟</a></span></div><div class=post-meta-line><span title="发布于 2017-06-20 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2017-06-20>2017-06-20</time></span>&nbsp;<span title="更新于 2023-05-02 19:18:14"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-05-02>2023-05-02</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>2327 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 5 分钟</span>&nbsp;<span id=/lets-encrypt/ class=comment-visitors data-flag-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=twikoo_visitors>-</span>&nbsp;次阅读
</span>&nbsp;<span id=/lets-encrypt/ class=comment-count data-flag-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS">
<i class="fa-regular fa-comments fa-fw me-1" aria-hidden=true></i><span id=twikoo-comment-count>-</span>&nbsp;条评论
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#安装客户端>安装客户端</a></li><li><a href=#获取证书>获取证书</a></li><li><a href=#配置-nginx>配置 Nginx</a><ul><li><a href=#什么是-http2->什么是 HTTP/2 ?</a></li><li><a href=#什么是-hsts->什么是 HSTS ?</a></li></ul></li><li><a href=#后续证书更新>后续证书更新</a></li></ul></nav></div></div><div class=post-ai><div class=ai-title><i class="fas fa-robot ai-title-icon"></i><div class=ai-title-text>AI 摘要</div></div><div id=ai-explanation class=ai-explanation></div><div class="ai-explanation ai-explanation-content" style=display:none>文章介绍了如何使用 Let's Encrypt SSL 证书配置 Nginx 开启站点的 HTTPS。首先，通过 certbot 工具申请证书，可以选择 webroot 或 standalone 插件获取证书。然后，将生成的证书文件配置到 Nginx 中，并添加一些安全配置，如开启 HTTP/2、HSTS 等。最后重启 Nginx 即可实现网站的 HTTPS 访问。同时提醒读者 90 天后需要运行命令进行续期操作。</div></div><div class=content id=content data-end-flag=" ------------- 文章结束，感谢您的阅读。 ------------- "><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2023-05-02，文中内容可能已过时。</div></div></div><h2 id=安装客户端>安装客户端</h2><p>Ubuntu 16.04.2 LTS 自带带有软件包，安装非常简单，直接一条命令搞定。</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apt-get install letsencrypt</span></span></code></pre></td></tr></table></div></div><p><strong>但是</strong>，官方最近提供 <a href=https://certbot.eff.org/ target=_blank rel="external nofollow noopener noreferrer">certbot<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 这样的自动化部署工具并推荐使用，我不太清楚上面这条命令所安装的客户端和 Certbot 是否一样，感觉是一样的，试了一下上面所安装的客户端用的操作指令是 <code>letsencrypt</code> ，certbot 用的指令是<code>certbot</code> 。</p><p><strong>并且</strong>，访问这官方工具的 Github 原来项目地址：https://github.com/letsencrypt/letsencrypt 会直接跳转到了 <a href=https://github.com/certbot/certbot target=_blank rel="external nofollow noopener noreferrer">https://github.com/certbot/certbot<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 。为了避免搞混淆，本文将统一使用 <code>certbot</code> 指令，因此，我<strong>并没有</strong>使用上面这条命令安装。</p><p>简单说明下，下面正式开始：</p><p>Certbot 官方地址 <a href=https://certbot.eff.org/ target=_blank rel="external nofollow noopener noreferrer">https://certbot.eff.org/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 里面有安装说明，你只要选择 Web服务器 （比如 Nginx）和操作系统 （ 比如 Ubuntu ）就会有比较详细的安装过程说明，但是既然在项目也提交在 Github 上，那么还是用 <code>git</code> 吧，下载并进入目录：</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git clone https://github.com/certbot/certbot
</span></span><span class=line><span class=cl>cd certbot</span></span></code></pre></td></tr></table></div></div><p>可以运行 <code>./certbot-auto --help</code> 看看说明。</p><h2 id=获取证书>获取证书</h2><p>Certbot 支持多种不同的插件来获取证书，比如 <a href=https://certbot.eff.org/docs/using.html#webroot target=_blank rel="external nofollow noopener noreferrer">webroot<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，多数文章会推荐这种，它的好处是不需要停止 Web 服务器，也就是获取过程中你的网站可以正常运行，但是这种方式需要指定目录及服务器上创建临时文件，通过 Let’s Encrypt 验证服务器发出 HTTP 请求，验证通过后即颁发证书，涉及目录权限之类的，容易出问题，为了避免不必要的麻烦，所以我没有用这个插件获取。</p><p>我用的是 <a href=https://certbot.eff.org/docs/using.html#standalone target=_blank rel="external nofollow noopener noreferrer">standalone<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> ，这种方式申请证书时将启动 Certbot 内置的 Webserver，这时候你的 80 和 443 端口不能被占用，通常是暂停 Web 服务器，我这里是 Nginx，个人网站嘛，暂停十几秒钟没什么影响。推荐不想出现各种奇怪问题的朋友用这种方式。</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/init.d/nginx stop</span></span></code></pre></td></tr></table></div></div><p>然后：</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>./certbot-auto certonly --standalone</span></span></code></pre></td></tr></table></div></div><p>提示输入域名，多个域名用<strong>空格</strong>隔开，比如输入<code>clearsky.me www.clearsky.me </code>，输入后回车。</p><p>也可以直接用 <code>-d</code> 直接加：</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>./certbot-auto certonly --standalone -d clearsky.me www.clearsky.me</span></span></code></pre></td></tr></table></div></div><p>出现：</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> - Congratulations! Your certificate and chain have been saved at
</span></span><span class=line><span class=cl>   /etc/letsencrypt/live/clearsky.me/fullchain.pem. Your cert will
</span></span><span class=line><span class=cl>   expire on 2017-09-17. To obtain a new or tweaked version of this
</span></span><span class=line><span class=cl>   certificate in the future, simply run certbot-auto again. To
</span></span><span class=line><span class=cl>   non-interactively renew *all* of your certificates, run
</span></span><span class=line><span class=cl>   &#34;certbot-auto renew&#34;
</span></span><span class=line><span class=cl> - If you like Certbot, please consider supporting our work by:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Donating to ISRG / Let&#39;s Encrypt:   https://letsencrypt.org/donate
</span></span><span class=line><span class=cl>   Donating to EFF:                    https://eff.org/donate-le</span></span></code></pre></td></tr></table></div></div><p>就成功了，看提示，所有的证书文件在 <code>/etc/letsencrypt/live/你的域名</code> 下，里面有下面几个文件：</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><ul><li><code>privkey.pem</code> 这是私匙，对应 Nginx 的 ssl_certificate_key 选项，或者 Apache2 的 SSLCertificateKeyFile 选项。</li><li><code>cert.pem</code> 服务器证书，这个只有 Apache2 低于 2.4.8 版本需要，对应 SSLCertificateFile 选项。</li><li><code>chain.pem</code> 除服务器证书之外的所有证书，对于 1.3.7 版以上的 Nginx 对应 ssl_trusted_certificate 选项，对于低于2.4.8 的 Apache2 对应 SSLCertificateChainFile 选项。</li><li><code>fullchain.pem</code> 包括上面的服务器证书和其他证书, Nginx 对应 ssl_certificate 选项，2.4.8 版以上的 Apache2 对应 SSLCertificateFile 选项。</li></ul></div></div></div><p>如果是 Nginx，需要上面的 <code>privkey.pem</code>（对应 ssl_certificate_key 选项）和 <code>fullchain.pem</code> （对应 ssl_certificate 选项），还需要一个 <code>dhparam.pem</code>（对应 ssl_dhparam 选项） 需自己生成：</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048</span></span></code></pre></td></tr></table></div></div><p>这个文件创建稍微需要一点时间，注意看我的路径，我的是在 <code>/etc/nginx/ssl/</code> 下，如果没有<code>ssl </code>这个目录就自己建一个，当然你换其他地方也行。</p><p>有了这三个文件: <code>privkey.pem</code>、<code>fullchain.pem</code> 、<code>dhparam.pem</code> 就可以配置 Nginx 了。</p><h2 id=配置-nginx>配置 Nginx</h2><p>我用的 Nginx 版本是 <code>1.10.0</code>，OpenSSL 版本为 <code>1.0.2g </code>。支持开启 HTTP/2，并开启 HSTS ，添加一个 301 跳转规则强制 HTTPS 。下面维基百科凑文章字数：</p><h3 id=什么是-http2->什么是 HTTP/2 ?</h3><blockquote><p><strong>HTTP/2</strong>（超文本传输协议第2版，最初命名为<strong>HTTP 2.0</strong>），是<a href=https://zh.wikipedia.org/wiki/HTTP target=_blank rel="external nofollow noopener noreferrer">HTTP<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>协议的的第二个主要版本，使用于<a href=https://zh.wikipedia.org/wiki/%E5%85%A8%E7%90%83%E8%B3%87%E8%A8%8A%E7%B6%B2 target=_blank rel="external nofollow noopener noreferrer">万维网<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。HTTP/2是<a href=https://zh.wikipedia.org/wiki/HTTP target=_blank rel="external nofollow noopener noreferrer">HTTP<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>协议自1999年HTTP 1.1发布后的首个更新，主要基于<a href=https://zh.wikipedia.org/wiki/SPDY target=_blank rel="external nofollow noopener noreferrer">SPDY<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>协议。它由<a href=https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E5%B7%A5%E7%A8%8B%E4%BB%BB%E5%8A%A1%E7%BB%84 target=_blank rel="external nofollow noopener noreferrer">互联网工程任务组<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>（IETF）的Hypertext Transfer Protocol Bis（httpbis）工作小组进行开发。[<a href=https://zh.wikipedia.org/wiki/HTTP/2#cite_note-charter-1 target=_blank rel="external nofollow noopener noreferrer">1]<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>该组织于2014年12月将HTTP/2标准提议递交至<a href="https://zh.wikipedia.org/w/index.php?title=Internet_Engineering_Steering_Group&amp;action=edit&amp;redlink=1" target=_blank rel="external nofollow noopener noreferrer">IESG<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>进行讨论[<a href=https://zh.wikipedia.org/wiki/HTTP/2#cite_note-2 target=_blank rel="external nofollow noopener noreferrer">2]<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，于2015年2月17日被批准。[<a href=https://zh.wikipedia.org/wiki/HTTP/2#cite_note-approval2-3 target=_blank rel="external nofollow noopener noreferrer">3]<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> HTTP/2标准于2015年5月以RFC 7540正式发表。[<a href=https://zh.wikipedia.org/wiki/HTTP/2#cite_note-rfc7540-4 target=_blank rel="external nofollow noopener noreferrer">4]<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></p></blockquote><h3 id=什么是-hsts->什么是 HSTS ?</h3><blockquote><p><strong>HTTP严格传输安全</strong>（英语：HTTP Strict Transport Security，<a href=https://zh.wikipedia.org/wiki/%E7%B8%AE%E5%AF%AB target=_blank rel="external nofollow noopener noreferrer">缩写<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>：HSTS）是一套由<a href=https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E5%B7%A5%E7%A8%8B%E4%BB%BB%E5%8A%A1%E7%BB%84 target=_blank rel="external nofollow noopener noreferrer">互联网工程任务组<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>发布的<a href=https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91 target=_blank rel="external nofollow noopener noreferrer">互联网<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>安全策略机制。<a href=https://zh.wikipedia.org/wiki/%E7%BD%91%E7%AB%99 target=_blank rel="external nofollow noopener noreferrer">网站<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>可以选择使用HSTS策略，来让<a href=https://zh.wikipedia.org/wiki/%E6%B5%8F%E8%A7%88%E5%99%A8 target=_blank rel="external nofollow noopener noreferrer">浏览器<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>强制使用<a href=https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE target=_blank rel="external nofollow noopener noreferrer">HTTPS<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>与网站进行通信，以减少<a href=https://zh.wikipedia.org/wiki/%E4%BC%9A%E8%AF%9D%E5%8A%AB%E6%8C%81 target=_blank rel="external nofollow noopener noreferrer">会话劫持<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>风险[<a href=https://zh.wikipedia.org/wiki/HTTP%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8#cite_note-cnet-1 target=_blank rel="external nofollow noopener noreferrer">1]<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>[<a href=https://zh.wikipedia.org/wiki/HTTP%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8#cite_note-cnw-2 target=_blank rel="external nofollow noopener noreferrer">2]<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p></blockquote><p>上面这种非正常人类语言看不看无所谓，主要目的是开启这些，会让你的站点 <a href=https://www.ssllabs.com/ssltest/ target=_blank rel="external nofollow noopener noreferrer">Qualys SSL Labs<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 评分很容易达到 <strong>A+</strong> ~~</p><p>所以，最后我的 Nginx 配置，关于 SSL 部分配置，我是用 <a href=https://mozilla.github.io/server-side-tls/ssl-config-generator/ target=_blank rel="external nofollow noopener noreferrer">Mozilla SSL Configuration Generator<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 来生成修改的，增加了一些安全配置。更多还在摸索中，保持更新：</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>listen</span>  <span class=mi>80</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>listen</span> <span class=p>[::]:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>server_name</span> <span class=n>clearsky</span><span class=o>.</span><span class=n>me</span> <span class=n>www</span><span class=o>.</span><span class=n>clearsky</span><span class=o>.</span><span class=n>me</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>301</span> <span class=n>https</span><span class=p>:</span><span class=o>//$</span><span class=n>server_name</span><span class=o>$</span><span class=n>request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>listen</span> <span class=mi>443</span> <span class=n>ssl</span> <span class=n>http2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>listen</span> <span class=p>[::]:</span><span class=mi>443</span> <span class=n>ssl</span> <span class=n>http2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>server_name</span> <span class=n>clearsky</span><span class=o>.</span><span class=n>me</span> <span class=n>www</span><span class=o>.</span><span class=n>clearsky</span><span class=o>.</span><span class=n>me</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1># 不输出 Nginx 版本号及其他错误信息 </span>
</span></span><span class=line><span class=cl>  <span class=n>server_tokens</span>   <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># HTTPS</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_certificate</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>letsencrypt</span><span class=o>/</span><span class=n>live</span><span class=o>/</span><span class=n>clearsky</span><span class=o>.</span><span class=n>me</span><span class=o>/</span><span class=n>fullchain</span><span class=o>.</span><span class=n>pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_certificate_key</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>letsencrypt</span><span class=o>/</span><span class=n>live</span><span class=o>/</span><span class=n>clearsky</span><span class=o>.</span><span class=n>me</span><span class=o>/</span><span class=n>privkey</span><span class=o>.</span><span class=n>pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_dhparam</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>ssl</span><span class=o>/</span><span class=n>dhparam</span><span class=o>.</span><span class=n>pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_session_cache</span> <span class=n>shared</span><span class=p>:</span><span class=n>SSL</span><span class=p>:</span><span class=mi>50</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_session_timeout</span> <span class=mi>1</span><span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_session_tickets</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_ciphers</span> <span class=s1>&#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_protocols</span> <span class=n>TLSv1</span> <span class=n>TLSv1</span><span class=o>.</span><span class=mi>1</span> <span class=n>TLSv1</span><span class=o>.</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_prefer_server_ciphers</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_stapling</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ssl_stapling_verify</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># 开启 HSTS,这么写是为了提交到 https://hstspreload.org/</span>
</span></span><span class=line><span class=cl>  <span class=n>add_header</span> <span class=n>Strict</span><span class=o>-</span><span class=n>Transport</span><span class=o>-</span><span class=n>Security</span> <span class=s2>&#34;max-age=31536000; includeSubdomains;preload&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># 网页不允许被 iframe 嵌套。</span>
</span></span><span class=line><span class=cl>  <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Frame</span><span class=o>-</span><span class=n>Options</span> <span class=n>DENY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># 不允许浏览器对未指定或错误指定的 Content-Type 资源真正类型的猜测行为。</span>
</span></span><span class=line><span class=cl>  <span class=n>add_header</span>  <span class=n>X</span><span class=o>-</span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=o>-</span><span class=n>Options</span>  <span class=n>nosniff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># 启用 XSS 保护，检查到 XSS 攻击时，停止渲染页面。</span>
</span></span><span class=line><span class=cl>  <span class=n>add_header</span> <span class=n>X</span><span class=o>-</span><span class=n>XSS</span><span class=o>-</span><span class=n>Protection</span> <span class=s2>&#34;1; mode=block&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># 下面这个还在找资料暂时不管，先注释。</span>
</span></span><span class=line><span class=cl>  <span class=c1>#add_header  Content-Security-Policy  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>hexo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>access_log</span>  <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>hexo_access</span><span class=o>.</span><span class=n>log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>error_log</span>   <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>hexo_error</span><span class=o>.</span><span class=n>log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>error_page</span> <span class=mi>404</span> <span class=o>=</span>  <span class=o>/</span><span class=mf>404.</span><span class=n>html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>location</span> <span class=o>~*</span> <span class=o>^.+</span>\<span class=o>.</span><span class=p>(</span><span class=n>ico</span><span class=o>|</span><span class=n>gif</span><span class=o>|</span><span class=n>jpg</span><span class=o>|</span><span class=n>jpeg</span><span class=o>|</span><span class=n>png</span><span class=p>)</span><span class=o>$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>hexo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>access_log</span>   <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>expires</span>      <span class=mi>1</span><span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>location</span> <span class=o>~*</span> <span class=o>^.+</span>\<span class=o>.</span><span class=p>(</span><span class=n>css</span><span class=o>|</span><span class=n>js</span><span class=o>|</span><span class=n>txt</span><span class=o>|</span><span class=n>xml</span><span class=o>|</span><span class=n>swf</span><span class=o>|</span><span class=n>wav</span><span class=p>)</span><span class=o>$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>hexo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>access_log</span>   <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>expires</span>      <span class=mi>10</span><span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>location</span> <span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>hexo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-</span><span class=n>f</span> <span class=o>$</span><span class=n>request_filename</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>rewrite</span> <span class=o>^/</span><span class=p>(</span><span class=o>.*</span><span class=p>)</span><span class=o>$</span>  <span class=o>/$</span><span class=mi>1</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>location</span> <span class=o>/</span><span class=n>nginx_status</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>stub_status</span> <span class=n>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>access_log</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>配置好了，别忘了重启 Nginx：</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/init.d/nginx restart</span></span></code></pre></td></tr></table></div></div><p>不出意外，地址栏小绿锁出现了。</p><h2 id=后续证书更新>后续证书更新</h2><p>Let&rsquo;s Encrypt SSL 免费证书为短期证书，只有 90 天期限，提示到期前可以运行命令 <code>./certbot-auto renew </code>续期，VPS 上可以设置定时任务自动化完成，我还没弄好，主要是不会写脚本。。。暂时先是这样，也不知道能不能行：</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>crontab -e</span></span></code></pre></td></tr></table></div></div><p>选择 <code>nano</code> 编辑：</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0 0 28 * * /etc/init.d/nginx stop
</span></span><span class=line><span class=cl>0 1 28 * * cd certbot &amp;&amp; ./certbot-auto renew
</span></span><span class=line><span class=cl>0 2 28 * * openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048
</span></span><span class=line><span class=cl>0 3 28 * * /etc/init.d/nginx restart</span></span></code></pre></td></tr></table></div></div><p>感觉好搓。。。等过两天休息有空了恶补下 Linux 命令再试试。</p><p>凌晨 4 点，又一个失眠晚上了，唉。。。</p><p>@update：2017.6.23，今天回家，没什么心思，直接几个命令硬凑一个脚本了：</p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>cd</span> certbot <span class=o>&amp;&amp;</span> openssl dhparam -out /etc/nginx/ssl/dhparam.pem <span class=m>2048</span> <span class=o>&amp;&amp;</span> /etc/init.d/nginx stop <span class=o>&amp;&amp;</span> ./certbot-auto renew --standalone <span class=o>&amp;&amp;</span> /etc/init.d/nginx start</span></span></code></pre></td></tr></table></div></div><p>保存为 <code>auto-renew.sh</code> ，扔到 <code>/root/scripts/</code> ，继续 <code>crontab -e</code> ，编辑为：</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0 0 28 * * sh scripts/auto-renew.sh</span></span></code></pre></td></tr></table></div></div><p>暂时这样吧。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2023-05-02 19:18:14">更新于 2023-05-02&nbsp;<a class=git-hash href=https://github.com/nyancccat/hugo-blog-source/commit/1cecf53f53bfac0297e7f4e94676cf414cfbe328 rel="external nofollow noopener noreferrer" target=_blank title="commit by nyancccat(theqee@gmail.com) 1cecf53f53bfac0297e7f4e94676cf414cfbe328: update"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>1cecf53</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/lets-encrypt/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href=https://github.com/nyancccat/hugo-blog-source/edit/master/content/posts/20170620-%e7%94%b3%e8%af%b7%20Let%27s%20Encrypt%20SSL%20%e8%af%81%e4%b9%a6%e9%85%8d%e7%bd%ae%20Nginx%20%e5%bc%80%e5%90%af%e7%ab%99%e7%82%b9%20HTTPS/index.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS" data-hashtags=SSL><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://clearsky.me/lets-encrypt/ data-hashtag=SSL><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><i data-svg-src=https://unpkg.com/simple-icons@9.19.0/icons/line.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS" data-description="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><i data-svg-src=https://unpkg.com/simple-icons@9.19.0/icons/myspace.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS" data-description="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><i class="fa-brands fa-blogger fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://clearsky.me/lets-encrypt/ data-title="申请 Let's Encrypt SSL 证书配置 Nginx 开启站点 HTTPS"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ssl/ class=post-tag>SSL</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/hexo-deploy-to-vps/ class=post-nav-item rel=prev title="Hexo 部署到搬瓦工 VPS"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Hexo 部署到搬瓦工 VPS</a>
<a href=/youtube-dl-ffmprg/ class=post-nav-item rel=next title="Ubuntu 16.04 使用 youtube-dl + FFmpeg 下载 Youtube 1080p 视频">Ubuntu 16.04 使用 youtube-dl + FFmpeg 下载 Youtube 1080p 视频<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=twikoo></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://twikoo.js.org/ rel="external nofollow noopener noreferrer">Twikoo</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom"><span id=run-time></span></div><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.120.4">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18-lts.5"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a>
| 托管于 <a title="Github Pages" href=https://docs.github.com/en/pages/ target=_blank rel="noopener noreffer">GitHub Pages</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><a href="https://ipw.cn/ssl/?site=clearsky.me" title=本站支持SSL安全访问 target=_blank class=icon_ip rel="noopener noreferrer">SSL</a>
<i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2009 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=http://clearsky.me/ target=_blank rel="external nofollow noopener noreferrer">pagezen</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a> <a href="https://ipw.cn/ipv6webcheck/?site=clearsky.me" title=本站支持IPv6访问 target=_blank class=icon_ip>IPv6</a></span></div><div class="footer-line statistics order-3"></div></div></footer><script>var meting_api="https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r"</script></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/nyancccat/ title="在 GitHub 上查看源代码" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=https://unpkg.com/lightgallery@2.7.2/css/lightgallery-bundle.min.css><link rel=preload href=https://unpkg.com/katex@0.16.9/dist/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/katex@0.16.9/dist/katex.min.css></noscript><link rel=stylesheet href=https://unpkg.com/pace-js@1.2.4/themes/blue/pace-theme-minimal.css><script src=https://unpkg.com/twikoo@1.6.22/dist/twikoo.all.min.js defer></script><script src=https://unpkg.com/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://unpkg.com/fuse.js@6.6.2/dist/fuse.min.js defer></script><script src=https://unpkg.com/twemoji@14.0.2/dist/twemoji.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/lightgallery.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=https://unpkg.com/lightgallery@2.7.2/plugins/zoom/lg-zoom.min.js defer></script><script src=https://unpkg.com/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://unpkg.com/katex@0.16.9/dist/katex.min.js defer></script><script src=https://unpkg.com/katex@0.16.9/dist/contrib/auto-render.min.js defer></script><script src=https://unpkg.com/katex@0.16.9/dist/contrib/copy-tex.min.js defer></script><script src=https://unpkg.com/katex@0.16.9/dist/contrib/mhchem.min.js defer></script><script src=https://unpkg.com/pangu@4.0.7/dist/browser/pangu.min.js defer></script><script src=https://unpkg.com/pace-js@1.2.4/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:80},comment:{enable:!0,expired:!1,twikoo:{commentCount:!0,el:"#twikoo",envId:"https://twikoo.clearsky.me/",lang:"zh-cn"}},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!0,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>